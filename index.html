<html>
  <head>
    <style>
    * {
      padding: 0;
      margin: 0;
    }

    nav{
      width: 100%;
      height: 45px;
      background: #151515;
    }
    </style>
    <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
    <script src="node_modules/xterm/lib/xterm.js"></script>
  </head>
  <body>
    <nav></nav>
    <div id="terminal"></div>
    <script>

//ptyProcess.write('sleep 10\r')
//ptyProcess.write('lolcat /c/Users/Javier/Developer/Term10/package.json\r')
//ptyProcess.write('echo "ðŸ˜ƒ"\r')

var term = new Terminal({
  fontFamily: 'Fira Code',
  fontSize: 14,
  lineHeight: 1.2
})

const { FitAddon } = require('xterm-addon-fit')

const fitAddon = new FitAddon();
term.loadAddon(fitAddon)
fitAddon.fit()

/*
term.prompt = () => {
  ptyProcess.write('\r\n')
}
*/

term.onLineFeed((e) => {
  console.log('lineFeed')
})

term.onData((e) => {
  console.log('data', e)
  console.log(term.getSelectionPosition())
  console.log(term.hasSelection())
})

term.onCursorMove((e) => {
  console.log('cursorMove', e)
  console.log(term.getSelectionPosition())
  console.log(term.hasSelection())
})

term.onBinary((e) => {
  console.log('binary', e)
})

term.onResize((e) => {
  ptyProcess.resize(e.cols, e.rows)
})

term.onKey((e) => {
  fitAddon.fit()
  const ev = e.domEvent;
  const printable = !ev.altKey && !ev.ctrlKey && !ev.metaKey;

  /*if (ev.keyCode === 13) {
    term.prompt();
  } else*/ if (ev.keyCode === 8) {
    // Do not delete the prompt
    if (term._core.buffer.x > 2) {
      ptyProcess.write('\b \b');
    }
  } else if (printable) {
    ptyProcess.write(e.key);
  }
})

const pty = require('node-pty')
const shell = 'ubuntu.exe'
const ptyProcess = pty.spawn(shell, [], {
  name: 'xterm-color',
  cols: 80,
  rows: 30,
  cwd: process.env.HOME,
  env: process.env
})

ptyProcess.on('data', function (data) {
  process.stdout.write(data)
  term.write(data)
})

term.open(document.getElementById('terminal'))
//term.write('Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ')
    </script>
  </body>
</html>